-- 모든 테이블 삭제
DROP TABLE IF EXISTS REVIEW, DETAIL_ODER, DELIVERY, PAYMENT, ODER, PRODUCT, USER;
-- 고객 테이블 생성
CREATE TABLE USER (
    USER_ID VARCHAR(50) NOT NULL, -- 아이디
    USER_NAME VARCHAR(50) NOT NULL, -- 이름
    EMAIL VARCHAR(100) NOT NULL, -- 이메일 주소
    PWD VARCHAR(200) NOT NULL, -- 비밀번호byplant
    ADDR VARCHAR(200) NOT NULL, -- 주소
    TEL VARCHAR(50) NOT NULL, -- 전화번호
    SUB INT NOT NULL, -- 구독상태
    PRIMARY KEY (USER_ID)
);
-- 제품 테이블 생성
CREATE TABLE PRODUCT (
    PD_ID INT AUTO_INCREMENT NOT NULL, -- 제품ID
    PD_NAME VARCHAR(50), -- 제품 이름
    PD_PRICE INT, -- 가격
    PD_OVERVIEW VARCHAR(2000), -- 설명
    PD_SQ INT, -- 재고 수량
    PD_IMG VARCHAR(200), -- 이미지 경로
    PRIMARY KEY (PD_ID)
);
-- 주문 테이블 생성
CREATE TABLE ODER (
    ORDER_ID INT AUTO_INCREMENT NOT NULL, -- 주문ID
    USER_ID VARCHAR(50) NOT NULL, -- 사용자ID
    ORDER_DATE DATETIME, -- 주문 날짜 시간
    ORDER_STATUS VARCHAR(30), -- 주문 상태
    PRIMARY KEY (ORDER_ID, USER_ID),
    FOREIGN KEY (USER_ID) REFERENCES USER(USER_ID)
);
-- 상세주문 테이블 생성
CREATE TABLE DETAIL_ODER (
    DO_ID INT AUTO_INCREMENT NOT NULL, -- 주문상세ID
    USER_ID VARCHAR(50) NOT NULL, -- 사용자ID
    ORDER_ID INT NOT NULL, -- 주문ID
    PD_ID INT NOT NULL, -- 제품ID
    ORDERQ INT, -- 주문수량
    DO_PRICE INT, -- 가격
    PRIMARY KEY (DO_ID, USER_ID, ORDER_ID, PD_ID),
    FOREIGN KEY (ORDER_ID, USER_ID) REFERENCES ODER(ORDER_ID, USER_ID),
    FOREIGN KEY (PD_ID) REFERENCES PRODUCT(PD_ID)
);
-- 결제 테이블 생성
CREATE TABLE PAYMENT (
    PAY_ID INT AUTO_INCREMENT NOT NULL, -- 결제ID
    USER_ID VARCHAR(50) NOT NULL, -- 사용자ID
    ORDER_ID INT NOT NULL, -- 주문ID
    PD_ID INT, -- 주문ID
    PAY_DATE DATETIME, -- 결제시간
    PAY_METHOD VARCHAR(30), -- 결제수단
    PRIMARY KEY (PAY_ID, USER_ID, ORDER_ID),
    FOREIGN KEY (ORDER_ID, USER_ID) REFERENCES ODER(ORDER_ID, USER_ID),
    FOREIGN KEY (PD_ID) REFERENCES PRODUCT(PD_ID)
);
-- 배송 테이블 생성
CREATE TABLE DELIVERY (
    DL_ID INT AUTO_INCREMENT NOT NULL, -- 배송ID
    USER_ID VARCHAR(50) NOT NULL, -- 사용자ID
    ORDER_ID INT NOT NULL, -- 주문ID
    DL_STATUS VARCHAR(30), -- 배송상태
    DL_ADDR VARCHAR(200), -- 배송주소
    PRIMARY KEY (DL_ID, USER_ID, ORDER_ID),
    FOREIGN KEY (ORDER_ID, USER_ID) REFERENCES ODER(ORDER_ID, USER_ID)
);
-- 리뷰 테이블 생성
CREATE TABLE REVIEW (
    RE_ID INT AUTO_INCREMENT NOT NULL, -- 리뷰ID
    USER_ID VARCHAR(50) NOT NULL, -- 사용자ID
    PD_ID INT NOT NULL, -- 제품ID
    RE_CONTENT VARCHAR(3000), -- 리뷰내용
    RE_STAR INT, -- 별점
    PRIMARY KEY (RE_ID, USER_ID, PD_ID),
    FOREIGN KEY (USER_ID) REFERENCES USER(USER_ID),
    FOREIGN KEY (PD_ID) REFERENCES PRODUCT(PD_ID)
);
INSERT INTO PRODUCT (PD_NAME, PD_PRICE, PD_OVERVIEW, PD_SQ, PD_IMG)
VALUES
('AIRBLISS N01', 10000, 'Description for Product1', 50, 'img/T.jpg'),
('AIRBLISS N02', 15000, 'Description for Product2', 30, 'img/R.jpg'),
('AIRBLISS N03', 8000, 'Description for Product3', 20, 'img/Y.jpg');
COMMIT;